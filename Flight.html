<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flight Status Notifier - Secure Access</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        // Configure Tailwind to respect the user's system preference for dark mode
        tailwind.config = {
            darkMode: 'media', // Use 'media' strategy for system preference
        }
    </script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .card {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            transition: transform 0.3s ease;
        }
        .card:hover {
            transform: translateY(-2px);
        }
        .btn-primary {
            background-color: #10b981; /* Emerald green */
            transition: background-color 0.2s;
        }
        .btn-primary:hover {
            background-color: #059669;
        }
        .btn-secondary {
            background-color: #3b82f6; /* Blue */
            transition: background-color 0.2s;
        }
        .btn-secondary:hover {
            background-color: #2563eb;
        }
        /* Ensure the app content starts hidden but is ready to be shown */
        #app-content.hidden {
            display: none;
        }
        /* Ensure the login screen is visible by default */
        #login-screen:not(.hidden) {
            display: block;
        }
    </style>
</head>
<body class="p-4 md:p-8 min-h-screen flex items-center justify-center bg-gray-50 dark:bg-gray-900 transition-colors duration-500">

    <!-- LOGIN SCREEN -->
    <div id="login-screen" class="w-full max-w-md">
        <div class="card bg-white dark:bg-gray-800 p-8 rounded-xl border border-gray-200 dark:border-gray-700">
            <h2 class="text-2xl font-bold text-gray-700 dark:text-gray-200 mb-6 text-center">Secure Access Required</h2>
            
            <form id="login-form">
                <div class="mb-4">
                    <label for="username" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">ID (Username)</label>
                    <input type="text" id="username" required
                           class="w-full p-2.5 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-lg focus:ring-emerald-500 focus:border-emerald-500">
                </div>
                <div class="mb-6">
                    <label for="password" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Password</label>
                    <input type="password" id="password" required
                           class="w-full p-2.5 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-lg focus:ring-emerald-500 focus:border-emerald-500">
                </div>
                <button type="submit"
                        class="btn-primary w-full text-white font-semibold py-2.5 rounded-lg hover:shadow-lg">
                    Login
                </button>
                <p id="login-error" class="text-sm text-red-500 mt-3 hidden text-center">Invalid ID or password.</p>
            </form>
        </div>
    </div>
    <!-- END LOGIN SCREEN -->

    <!-- MAIN APP CONTENT (Initially Hidden) -->
    <div id="app-content" class="w-full max-w-4xl hidden">

        <header class="text-center mb-8">
            <h1 class="text-3xl font-extrabold text-gray-800 dark:text-white mb-1">Flight Status Notifier</h1>
            <p class="text-md text-gray-500 dark:text-gray-400">Input data manually, or use Search for real-time autofill.</p>
        </header>

        <!-- Main Card Container (Reduced Padding: p-10 -> p-6) -->
        <div class="card bg-white dark:bg-gray-800 p-6 rounded-xl border border-gray-200 dark:border-gray-700 transition-colors duration-500">

            <div id="input-section">
                <h2 class="text-xl font-bold text-gray-700 dark:text-gray-200 mb-4 border-b pb-2 dark:border-gray-700">1. Input Flight Details</h2>
                
                <!-- Reduced Gap: gap-6 -> gap-4 -->
                <form id="flight-form" class="grid grid-cols-1 md:grid-cols-2 gap-4">

                    <!-- Flight Number with Search Button -->
                    <div class="md:col-span-2">
                        <label for="flight-number" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Flight Number (e.g., QF1, AK704)</label>
                        <div class="flex items-stretch gap-2">
                            <!-- Input Padding Reduced: p-3 -> p-2.5 -->
                            <input type="text" id="flight-number" placeholder="Enter flight number" required
                                   class="flex-grow p-2.5 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-lg focus:ring-emerald-500 focus:border-emerald-500">
                            <button type="button" id="fr24-search-btn"
                                    class="btn-secondary text-white font-semibold py-2.5 px-4 rounded-lg hover:shadow-lg flex items-center justify-center text-sm w-32 disabled:bg-gray-500">
                                Search
                            </button>
                        </div>
                        <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">Click Search for **Autofill** (requires API proxy) or opens FR24 for manual lookup.</p>
                    </div>

                    <div>
                        <label for="city-pair" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Route (e.g., SYD to LHR) [FOR CONTEXT]</label>
                        <!-- Input Padding Reduced: p-3 -> p-2.5 -->
                        <input type="text" id="city-pair" placeholder="e.g., SFO to NRT" required
                               class="w-full p-2.5 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-lg focus:ring-emerald-500 focus:border-emerald-500">
                    </div>

                    <!-- Plane Registration -->
                    <div class="md:col-span-1">
                        <label for="plane-registration" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Plane Registration (e.g., 9M-VAE)</label>
                        <!-- Input Padding Reduced: p-3 -> p-2.5 -->
                        <input type="text" id="plane-registration" placeholder="Enter registration number" required
                               class="w-full p-2.5 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-lg focus:ring-emerald-500 focus:border-emerald-500">
                    </div>
                    
                    <!-- Bay/Gate -->
                    <div class="md:col-span-1">
                        <label for="bay-gate" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Bay / Gate Number (e.g., K6, C12)</label>
                        <!-- Input Padding Reduced: p-3 -> p-2.5 -->
                        <input type="text" id="bay-gate" placeholder="Enter Bay/Gate"
                                class="w-full p-2.5 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-lg focus:ring-emerald-500 focus:border-emerald-500">
                    </div>

                    
                    <div> 
                        <label for="message-type" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Message Type</label>
                        <!-- Input Padding Reduced: p-3 -> p-2.5 -->
                        <select id="message-type" 
                                class="w-full p-2.5 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-lg focus:ring-emerald-500 focus:border-emerald-500 appearance-none">
                            <option value="ETA" class="bg-white dark:bg-gray-700">ETA</option>
                            <option value="STD" class="bg-white dark:bg-gray-700">STD</option>
                            <option value="DELAYED_STD" class="bg-white dark:bg-gray-700">DELAYED STD</option>
                        </select>
                    </div>

                    <!-- Flight Date Input - Value is set to today's date on load -->
                    <div> 
                        <label for="flight-date" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Flight Date [FOR CONTEXT]</label>
                        <!-- Input Padding Reduced: p-3 -> p-2.5 -->
                        <input type="date" id="flight-date" required
                               class="w-full p-2.5 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-lg focus:ring-emerald-500 focus:border-emerald-500">
                    </div>

                    <div class="md:col-span-1">
                        <label for="time-value" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Time Value (HHMM Military Time, 24h)</label>
                        <!-- Text input enforces 4-digit military time. Input Padding Reduced: p-3 -> p-2.5 -->
                        <input type="text" id="time-value" placeholder="e.g., 1110" required maxlength="4"
                               class="w-full p-2.5 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-lg focus:ring-emerald-500 focus:border-emerald-500">
                    </div>
                    
                    <!-- Recipient Handle/Mention -->
                    <div class="md:col-span-1">
                        <label for="recipient-handle" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
                            Recipient Handle/Mention (Optional)
                        </label>
                        <!-- Input Padding Reduced: p-3 -> p-2.5 -->
                        <input type="text" id="recipient-handle" placeholder="e.g., Attention Team Alpha"
                               class="w-full p-2.5 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-lg focus:ring-emerald-500 focus:border-emerald-500">
                    </div>
                    
                    <!-- Secondary Ops Block Checkbox -->
                    <div class="md:col-span-2 flex items-center mt-1">
                        <input type="checkbox" id="include-ops-block" 
                               class="h-5 w-5 text-emerald-600 border-gray-300 dark:border-gray-600 dark:bg-gray-700 rounded focus:ring-emerald-500">
                        <label for="include-ops-block" class="ml-3 text-sm font-medium text-gray-700 dark:text-gray-300">
                            Include Secondary Ops Block (VDGS / KETUK PINTU)
                        </label>
                    </div>


                    <div class="md:col-span-2 mt-3 flex justify-end">
                        <button type="submit"
                                class="btn-primary text-white font-semibold py-2.5 px-6 rounded-lg hover:shadow-lg flex items-center">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 13.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                            </svg>
                            Generate Message
                        </button>
                    </div>
                </form>
            </div>

            <!-- Output Section -->
            <!-- Reduced top margin: mt-10 -> mt-6 -->
            <div id="output-section" class="mt-6 pt-4 border-t border-gray-200 dark:border-gray-700 hidden">
                <h2 class="text-xl font-bold text-gray-700 dark:text-gray-200 mb-4">2. Generated Phrase & Sharing</h2>
                
                <!-- Generated Text Display -->
                <div class="mb-4">
                    <label for="generated-message" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Readable Status Phrase (Copy/Paste Ready):</label>
                    <div class="relative">
                        <!-- Reduced height: rows="4" -> rows="3" for conciseness -->
                        <textarea id="generated-message" rows="3" readonly
                                  class="w-full p-3 border border-blue-400 dark:border-blue-600 bg-blue-50 dark:bg-blue-900/50 rounded-lg text-lg text-gray-800 dark:text-gray-200 resize-none"></textarea>
                        <button id="copy-text-btn" class="absolute top-2 right-2 p-2 bg-gray-200 dark:bg-gray-600 rounded-full hover:bg-gray-300 dark:hover:bg-gray-700 transition" title="Copy to Clipboard">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-600 dark:text-gray-300" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v2"/>
                            </svg>
                        </button>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="flex flex-col sm:flex-row gap-4">
                    <button id="whatsapp-link-btn" 
                            class="btn-primary flex-1 text-white font-semibold py-2.5 px-6 rounded-lg hover:shadow-lg flex items-center justify-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12.031 3.175c-4.825 0-8.73 3.905-8.73 8.73 0 1.956.634 3.766 1.72 5.253L3 21l3.865-1.071c1.42.78 3.056 1.205 4.166 1.205h.001c4.825 0 8.73-3.905 8.73-8.73s-3.905-8.73-8.73-8.73zM16.92 15.655c-.24-.12-.482-.19-.74-.23-1.018-.15-2.45-.63-2.78-1.74-.32-1.11-.8-2.61-.48-3.94.32-1.33 1.76-2.02 2.78-2.17.25-.04.49-.07.74-.07.25 0 .5-.01.75.26.25.26.26.54.26.75.0 1.07-.48 2.08-.96 3.16-.48 1.08-1.06 2.16-1.54 3.24-.48 1.08-.24 2.16-.48 3.24-.24.78-1.28.39-1.54-.39-.26-1.17-.48-2.34-.48-3.51 0-.17.06-.34.19-.5z"/>
                        </svg>
                        Share via WhatsApp
                    </button>

                    <a id="fr24-link-anchor" href="#" target="_blank"
                       class="btn-secondary flex-1 text-white font-semibold py-2.5 px-6 rounded-lg hover:shadow-lg flex items-center justify-center">
                       <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
                            <path d="M11 3a1 1 0 100 2h3.586l-11.5 11.5a1 1 0 101.414 1.414L16 6.414V10a1 1 0 102 0V4a2 2 0 00-2-2h-6z" />
                        </svg>
                        View Live Status on FR24
                    </a>
                </div>

                <!-- Custom Modal for Errors/Notifications (Replacing alert()) -->
                <div id="app-modal" class="hidden fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center p-4 z-50">
                    <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-2xl max-w-sm w-full">
                        <h3 id="modal-title" class="text-xl font-bold text-gray-800 dark:text-white mb-4">Notification</h3>
                        <p id="modal-message" class="text-gray-600 dark:text-gray-300 mb-6"></p>
                        <button id="close-modal-btn" class="w-full bg-emerald-500 text-white py-2 rounded-lg hover:bg-emerald-600">Close</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- END MAIN APP CONTENT -->

    <script>
        // --- LOGIN LOGIC ---
        const DEMO_ID = 'opsuser';
        const DEMO_PASSWORD = 'flight247';
        
        const loginForm = document.getElementById('login-form');
        const loginScreen = document.getElementById('login-screen');
        const appContent = document.getElementById('app-content');
        const loginError = document.getElementById('login-error');

        loginForm.addEventListener('submit', function(e) {
            e.preventDefault();
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value.trim();

            if (username === DEMO_ID && password === DEMO_PASSWORD) {
                loginScreen.classList.add('hidden');
                appContent.classList.remove('hidden');
                // Initialize the rest of the app once successfully logged in
                initApp();
            } else {
                loginError.classList.remove('hidden');
            }
        });
        // --- END LOGIN LOGIC ---


        // Set up references to elements
        const form = document.getElementById('flight-form');
        const outputSection = document.getElementById('output-section');
        const generatedMessageArea = document.getElementById('generated-message');
        const copyBtn = document.getElementById('copy-text-btn');
        const whatsappBtn = document.getElementById('whatsapp-link-btn');
        const fr24LinkAnchor = document.getElementById('fr24-link-anchor');
        const fr24SearchBtn = document.getElementById('fr24-search-btn');
        const modal = document.getElementById('app-modal');
        const modalTitle = document.getElementById('modal-title');
        const modalMessage = document.getElementById('modal-message');
        const closeModalBtn = document.getElementById('close-modal-btn');
        const flightDateInput = document.getElementById('flight-date'); 
        const recipientHandleInput = document.getElementById('recipient-handle');
        const planeRegistrationInput = document.getElementById('plane-registration');
        const bayGateInput = document.getElementById('bay-gate');
        const cityPairInput = document.getElementById('city-pair');
        const timeValueInput = document.getElementById('time-value');
        const messageTypeInput = document.getElementById('message-type');
        const flightNumberInput = document.getElementById('flight-number');
        const includeOpsBlockCheckbox = document.getElementById('include-ops-block'); 


        // --- HARDCODED CONFIGURATION (Replace with your server URL!) ---
        const API_PROXY_URL = 'https://zahrinshahab.workers.dev/fr24-proxy'; 
        // ----------------------------------------------------------------

        // --- Initialization: Set Default Date ---
        function initApp() {
            const today = new Date();
            const year = today.getFullYear();
            const month = String(today.getMonth() + 1).padStart(2, '0'); 
            const day = String(today.getDate()).padStart(2, '0');
            flightDateInput.value = `${year}-${month}-${day}`;
            
            // Enable the search button now that the element is ready
            fr24SearchBtn.disabled = false;
        }
        // --- End Initialization ---


        // --- Helper Functions ---

        /**
         * Shows a custom modal notification.
         */
        function showModal(title, message) {
            modalTitle.textContent = title;
            modalMessage.textContent = message;
            modal.classList.remove('hidden');
        }

        // Event listener for closing the modal
        closeModalBtn.addEventListener('click', () => {
            modal.classList.add('hidden');
        });


        // --- API & Autofill Logic ---

        /**
         * Handles exponential backoff for API retries.
         */
        async function waitForDelay(attempt) {
            const delay = Math.pow(2, attempt) * 1000;
            return new Promise(resolve => setTimeout(resolve, delay));
        }

        /**
         * Simulates fetching data from a secure proxy with retries.
         */
        async function fetchFlightData(flightNumber) {
            if (API_PROXY_URL === 'REPLACE_WITH_YOUR_SECURE_PROXY_URL') {
                // Mock data for testing when the URL hasn't been configured
                return { 
                    status: 'mock', 
                    data: {
                        registration: '9M-VAZ',
                        bayGate: 'A15',
                        route: 'KUL to BKK',
                        liveTime: '1630', // New ETA/STD in HHMM format
                        status: 'ETA' 
                    }
                };
            }

            const maxRetries = 3;
            for (let i = 0; i < maxRetries; i++) {
                try {
                    const response = await fetch(API_PROXY_URL, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ flightNumber })
                    });

                    if (!response.ok) {
                        throw new Error(`Server returned status ${response.status}`);
                    }
                    const result = await response.json();
                    
                    if (result.status === 'success' && result.realTime) {
                        return { status: 'live', data: result.realTime };
                    } else {
                        throw new Error('Invalid data structure from proxy.');
                    }

                } catch (error) {
                    console.error(`Attempt ${i + 1} failed:`, error.message);
                    if (i < maxRetries - 1) {
                        await waitForDelay(i); // Use exponential backoff
                    }
                }
            }
            throw new Error('Failed to fetch flight data after multiple retries.');
        }

        // Search Button Logic (Autofill)
        fr24SearchBtn.addEventListener('click', async function() {
            const flightNumber = flightNumberInput.value.trim();
            if (!flightNumber) {
                showModal("Input Required", "Please enter a Flight Number before searching.");
                return;
            }

            // 1. Initial Link to FR24 (Always useful)
            const fr24Url = `https://www.flightradar24.com/data/${encodeURIComponent(flightNumber)}`;
            window.open(fr24Url, '_blank');

            // 2. Attempt Autofill
            const originalText = fr24SearchBtn.textContent;
            fr24SearchBtn.textContent = 'Fetching...';
            fr24SearchBtn.disabled = true;
            
            try {
                const result = await fetchFlightData(flightNumber);
                const data = result.data;

                // Autofill the fields
                planeRegistrationInput.value = data.registration.toUpperCase();
                bayGateInput.value = data.bayGate.toUpperCase();
                cityPairInput.value = data.route;
                timeValueInput.value = data.liveTime;
                messageTypeInput.value = data.status; // ETA or STD
                
                showModal("Autofill Success", `Live data fetched and autofilled from ${result.status} source.`);
                
            } catch (error) {
                console.error("Autofill error:", error);
                if (API_PROXY_URL === 'REPLACE_WITH_YOUR_SECURE_PROXY_URL') {
                    showModal("Autofill Disabled", "Autofill is using mock data. Update the API_PROXY_URL variable in the script with your secure server address to enable live data fetching.");
                } else {
                     showModal("Autofill Failed", `Failed to get live data. Please check your proxy server logs.`);
                }
            } finally {
                fr24SearchBtn.textContent = originalText;
                fr24SearchBtn.disabled = false;
            }
        });

        // --- Message Generation Logic ---

        /**
         * Generates the readable phrase based on input data.
         */
        function generatePhrase(flightNumber, timeValue, messageType, recipientHandle, planeRegistration, bayGate, includeOpsBlock) {
            // Convert requested values to UPPERCASE
            const time = timeValue; 
            const flight = flightNumber.toUpperCase();
            const registration = planeRegistration.toUpperCase();
            const bay = bayGate.toUpperCase(); 
            
            // Format messageType for display (e.g., DELAYED_STD -> DELAYED STD)
            const type = messageType.toUpperCase().replace('_', ' '); 
            
            // Start the phrase clean
            let phrase = ''; 

            // Conciseness: REG, BAY, FLIGHT // TYPE, TIME
            phrase += `${registration}    ${bay}    ${flight}    //    ${type}    ${time}`; 
            
            // --- OPERATIONAL INSTRUCTIONS BLOCK (Core) ---
            phrase += `\n\nTEAM VDGS KINDLY STANDBY\nANY CLASHING KINDLY INFORM ASAP\nPLS UPDATE TIMING ONCHOCK`;
            
            // --- Secondary Ops Block (Conditional) ---
            if (includeOpsBlock) {
                // Add the new block of words as requested
                phrase += `\n\nVDGS MONITOR / KETUK PINTU / BUANG SAMPAH`;
            }

            // --- Recipient Handle (Optional, last element) ---
            if (recipientHandle) {
                // Add the Recipient Handle last
                phrase += `\n\n${recipientHandle.toUpperCase()}`;
            }

            return phrase;
        }

        // --- Main Form Event Handler ---

        form.addEventListener('submit', function(e) {
            e.preventDefault();

            const flightNumber = flightNumberInput.value.trim();
            const cityPair = cityPairInput.value.trim();
            const planeRegistration = planeRegistrationInput.value.trim();
            const bayGate = bayGateInput.value.trim(); 
            const timeValue = timeValueInput.value.trim();
            const messageType = messageTypeInput.value;
            const includeOps = includeOpsBlockCheckbox.checked; // Get state of the new checkbox
            
            // Use the single text input value
            let recipientHandle = recipientHandleInput.value.trim(); 

            // Validation checks
            if (!flightNumber || !cityPair || !planeRegistration || !bayGate || !timeValue) {
                showModal("Input Error", "Please fill out all required fields.");
                return;
            }

            // Validation for HHMM military time format
            const militaryTimeRegex = /^([01]\d|2[0-3])[0-5]\d$/;
            if (!militaryTimeRegex.test(timeValue) || timeValue.length !== 4) {
                showModal("Input Error", "Time Value must be in 4-digit military format (HHMM), e.g., 1110. Hours must be 00-23 and Minutes 00-59.");
                return;
            }

            // Generate the readable phrase
            const generatedPhrase = generatePhrase(flightNumber, timeValue, messageType, recipientHandle, planeRegistration, bayGate, includeOps);
            generatedMessageArea.value = generatedPhrase;
            
            // Show output section and set up links
            outputSection.classList.remove('hidden');
            setupSharingLinks(generatedPhrase, flightNumber);
        });

        // 2. Button: Copy Text to Clipboard
        copyBtn.addEventListener('click', function() {
            const textToCopy = generatedMessageArea.value;

            const textarea = document.createElement('textarea');
            textarea.value = textToCopy;
            document.body.appendChild(textarea);
            textarea.select();

            try {
                document.execCommand('copy');
                showModal("Copy Status", 'The phrase has been successfully copied to your clipboard!');
            } catch (err) {
                showModal("Copy Status", 'Copy failed. Please copy the text manually.');
            } finally {
                document.body.removeChild(textarea);
            }
        });


        /**
         * Sets up the dynamic WhatsApp and FR24 links based on generated content.
         */
        function setupSharingLinks(phrase, flightNumber) {
            // WhatsApp Link Generation (Always uses generic sharing now)
            const whatsappText = encodeURIComponent(phrase);
            const whatsappUrl = `https://api.whatsapp.com/send?text=${whatsappText}`;
            
            whatsappBtn.href = whatsappUrl;
            whatsappBtn.onclick = () => window.open(whatsappUrl, '_blank');

            // Flightradar24 Direct Link Generation (External Link)
            const fr24Url = `https://www.flightradar24.com/data/${encodeURIComponent(flightNumber)}`;
            fr24LinkAnchor.href = fr24Url;
        }

    </script>
</body>
</html>
